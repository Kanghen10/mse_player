<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MSE Player Portable</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    background: black;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  video-stream {
    width: 100vw;
    height: 100vh;
    object-fit: contain;
    background: black;
  }
</style>
<script type="module" src="./video-stream.js"></script>
<script type="module">
(function() {
  let hash = location.hash ? decodeURIComponent(location.hash.substring(1)) : "";
  let finalSrc = "";
  let finalMode = "mse"; // pastikan selalu MSE

  if (hash.startsWith("http") && hash.includes("stream.html")) {
    try {
      let urlObj = new URL(hash);
      let srcParam = urlObj.searchParams.get("src");
      let protocol = urlObj.protocol === "https:" ? "wss:" : "ws:";
      finalSrc = `${protocol}//${urlObj.host}/api/ws?src=${encodeURIComponent(srcParam)}`;
    } catch (e) {
      console.error("Gagal parse URL stream.html:", e);
    }
  } else if (hash.startsWith("wss://") || hash.startsWith("ws://")) {
    finalSrc = hash;
  }

  if (!finalSrc) {
    document.body.innerHTML = "<h1 style='color:white'>No valid stream URL</h1>";
    return;
  }

  const video = document.createElement("video-stream");
  video.background = true;
  video.mode = finalMode;
  video.autoplay = true;
  video.src = finalSrc;

  document.body.appendChild(video);
})();
</script>
</head>
<body>
</body>
</html>
